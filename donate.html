<!DOCTYPE html>
<html lang="fa">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>حمایت از میلاد کاتاکوری</title>
<style>
body { font-family: Tahoma, sans-serif; background: #f9f9f9; margin: 0; padding: 0; }
.container { max-width: 500px; margin: 50px auto; background: #fff; padding: 25px; border-radius: 10px; box-shadow: 0 0 15px rgba(0,0,0,0.1);}
h1 { text-align: center; margin-bottom: 20px; font-size: 24px; }
label { display: block; margin-bottom: 5px; font-weight: bold; }
input, textarea { width: 100%; padding: 10px; margin-bottom: 15px; font-size: 16px; border: 1px solid #ccc; border-radius: 5px; box-sizing: border-box;}
input:focus, textarea:focus { border-color: #888; outline: none;}
button { width: 100%; padding: 12px; font-size: 18px; border-radius: 5px; border: none; cursor: pointer;}
button#shaparak { background: #00aaff; color: #fff; margin-bottom: 15px;}
button#nowpayments { background: #fff; color: #000; border: 1px solid #ccc; margin-bottom: 15px;}
#usdt_display { margin-top: -10px; margin-bottom: 15px; font-size: 16px; color: #333;}
</style>
</head>
<body>
<div class="container">
  <h1>حمایت از میلاد کاتاکوری</h1>
  <label for="name">نام</label>
  <input type="text" id="name" placeholder="نام شما (اختیاری)">

  <label for="phone">شماره تماس</label>
  <input type="text" id="phone" placeholder="شماره تماس (اختیاری)">

  <label for="comment">کامنت</label>
  <textarea id="comment" rows="3" placeholder="پیام شما (اختیاری)"></textarea>

  <label for="amount_toman">مبلغ (تومان)</label>
  <input type="number" id="amount_toman" placeholder="مبلغ به تومان">

  <div id="usdt_display">USDT: 0</div>

  <button id="shaparak">پرداخت با شاپرک</button>
  <a href="https://nowpayments.io/donation?api_key=0289ad3c-32ce-4361-96a2-d2951b0ee943" target="_blank" rel="noreferrer noopener">
    <button id="nowpayments">پرداخت با NowPayments</button>
  </a>
</div>

<script>
const amountInput = document.getElementById('amount_toman');
const usdtDisplay = document.getElementById('usdt_display');
const shaparakBtn = document.getElementById('shaparak');

// نرخ لحظه‌ای USDT/IRR از نوبیتکس
async function getUSDTRate() {
    try {
        const res = await fetch('https://api.nobitex.ir/market/stats/USDTIRT');
        const data = await res.json();
        return parseFloat(data.last_price); // نرخ لحظه‌ای
    } catch (e) {
        console.error('خطا در دریافت نرخ USDT', e);
        return 45000; // fallback
    }
}

// نمایش لحظه‌ای USDT
async function updateUSDTDisplay() {
    const rate = await getUSDTRate();
    const amountToman = parseFloat(amountInput.value) || 0;
    const usdtAmount = amountToman / rate;
    usdtDisplay.textContent = `${amountToman.toLocaleString()} تومان ≈ ${usdtAmount.toFixed(2)} USDT`;
}

amountInput.addEventListener('input', updateUSDTDisplay);

// پرداخت شاپرک
shaparakBtn.addEventListener('click', async () => {
    const name = encodeURIComponent(document.getElementById('name').value);
    const phone = encodeURIComponent(document.getElementById('phone').value);
    const comment = encodeURIComponent(document.getElementById('comment').value);
    const amountToman = parseFloat(amountInput.value) || 0;
    const rate = await getUSDTRate();
    const usdtAmount = (amountToman / rate).toFixed(2);

    // ارسال به درگاه شاپرک (مثال: لینک با پارامترها)
    const url = `https://yourshaparakgateway.com/pay?amount_toman=${amountToman}&usdt=${usdtAmount}&name=${name}&phone=${phone}&comment=${comment}`;
    window.open(url, '_blank');
});
</script>
</body>
</html>
