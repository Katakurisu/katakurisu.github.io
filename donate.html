<!DOCTYPE html>
<html lang="fa">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>حمایت از میلاد کاتاکوری</title>
<style>
    body { font-family: Tahoma, sans-serif; background-color: #f8f8f8; display: flex; justify-content: center; align-items: center; height: 100vh; }
    .donate-container { background: #fff; padding: 25px; border-radius: 10px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); width: 100%; max-width: 420px; }
    h2 { text-align: center; margin-bottom: 20px; }
    label { display: block; margin-top: 15px; font-weight: bold; font-size: 1rem; }
    input { width: 100%; padding: 12px; font-size: 1rem; border: 1px solid #ccc; border-radius: 6px; box-sizing: border-box; }
    .amount-display { margin-top: 10px; font-weight: bold; font-size: 0.95rem; color: #333; }
    .donate-btn { margin-top: 25px; width: 100%; padding: 15px; background: #fff; border: 1px solid #999; border-radius: 6px; font-weight: bold; cursor: pointer; transition: 0.2s; }
    .donate-btn:hover { background: #f0f0f0; }
</style>
</head>
<body>
<div class="donate-container">
    <h2>حمایت از میلاد کاتاکوری</h2>
    <form id="donateForm">
        <label for="name">نام</label>
        <input type="text" id="name" placeholder="نام خود را وارد کنید">

        <label for="phone">شماره تماس (اختیاری)</label>
        <input type="text" id="phone" placeholder="شماره تماس">

        <label for="amount">مبلغ به تومان</label>
        <input type="number" id="amount" placeholder="مثال: 666000" min="0">

        <div class="amount-display" id="amountDisplay">۰ تومان = ۰ USDT</div>

        <button type="submit" class="donate-btn">حمایت با NowPayments</button>
    </form>
</div>

<script>
const amountInput = document.getElementById('amount');
const amountDisplay = document.getElementById('amountDisplay');
const form = document.getElementById('donateForm');

// نرخ تتر لحظه‌ای از نوبیتکس
let usdtRate = 0;
async function fetchUSDT() {
    try {
        const res = await fetch('https://api.nobitex.ir/v2/orderbook/?market=usdt-irt');
        const data = await res.json();
        usdtRate = parseFloat(data.ticker.last); // آخرین نرخ تتر به ریال
        updateDisplay();
    } catch (e) {
        console.error('خطا در دریافت نرخ تتر:', e);
    }
}

// نمایش مقدار تومان و USDT
function updateDisplay() {
    const tomans = parseFloat(amountInput.value) || 0;
    const irt = tomans * 10; // تومان → ریال
    const usdt = usdtRate ? (irt / usdtRate).toFixed(2) : 0;
    amountDisplay.textContent = `${tomans.toLocaleString()} تومان = ${usdt} USDT`;
}

// رفرش نرخ تتر هر 30 ثانیه
setInterval(fetchUSDT, 30000);
fetchUSDT();

amountInput.addEventListener('input', updateDisplay);

// ارسال فرم به NowPayments
form.addEventListener('submit', e => {
    e.preventDefault();
    const amount = parseFloat(amountInput.value) || 0;
    if(amount <= 0) return alert('لطفا مبلغ صحیح وارد کنید');
    const apiKey = 'MP94SK3-2RNMDJ4-PPKQWSS-GHCVMNJ';
    const url = `https://nowpayments.io/donation?api_key=${apiKey}&price_amount=${amount}&price_currency=IRR`;
    window.open(url, '_blank');
});
</script>
</body>
</html>
