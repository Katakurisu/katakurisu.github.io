<!DOCTYPE html>
<html lang="fa">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>حمایت با تتر</title>
<style>
body { font-family: Arial, sans-serif; background: #f5f5f5; display: flex; justify-content: center; align-items: center; height: 100vh; }
.container { background: #fff; padding: 30px; border-radius: 10px; box-shadow: 0 0 15px rgba(0,0,0,0.1); width: 400px; }
h2 { text-align: center; margin-bottom: 20px; }
input, button { width: 100%; padding: 12px; margin: 8px 0; border-radius: 5px; border: 1px solid #ccc; font-size: 16px; }
button { background-color: #fff; border: 1px solid #888; cursor: pointer; font-weight: bold; }
button:hover { background-color: #f0f0f0; }
.result { margin-top: 10px; font-weight: bold; text-align: center; }
</style>
</head>
<body>
<div class="container">
  <h2>حمایت با تتر (USDT)</h2>
  <label>نام (اختیاری)</label>
  <input type="text" id="name" placeholder="نام شما">
  
  <label>شماره تماس (اختیاری)</label>
  <input type="text" id="phone" placeholder="شماره تماس">
  
  <label>مبلغ (تومان)</label>
  <input type="number" id="amount" placeholder="مثال: 500000">
  
  <div class="result" id="usdtResult">مقدار USDT: 0.00</div>
  
  <button id="donateBtn">پرداخت با NowPayments</button>
</div>

<script>
// URL API نوبیتکس برای تتر
const USDT_API_URL = 'https://api.nobitex.ir/market/ticker/USDTIRR';

const amountInput = document.getElementById('amount');
const resultDiv = document.getElementById('usdtResult');
const donateBtn = document.getElementById('donateBtn');

let usdtRate = 0;

// گرفتن نرخ لحظه‌ای USDT از Nobitex هر 30 ثانیه
async function fetchRate() {
    try {
        const res = await fetch(USDT_API_URL);
        const data = await res.json();
        usdtRate = parseFloat(data.last_price); // آخرین قیمت IRR/USDT
        updateResult();
    } catch (e) {
        console.error("خطا در دریافت نرخ تتر:", e);
    }
}

// بروزرسانی مقدار USDT
function updateResult() {
    const amountToman = parseFloat(amountInput.value);
    if (!isNaN(amountToman) && usdtRate > 0) {
        const amountUSDT = amountToman / usdtRate;
        resultDiv.textContent = `${amountToman.toLocaleString('fa-IR')} تومان = ${amountUSDT.toFixed(2)} USDT`;
    } else {
        resultDiv.textContent = "مقدار USDT: 0.00";
    }
}

// داینامیک بروزرسانی هنگام تایپ
amountInput.addEventListener('input', updateResult);

// دکمه پرداخت
donateBtn.addEventListener('click', () => {
    const amountToman = parseFloat(amountInput.value);
    if (isNaN(amountToman) || amountToman <= 0) {
        alert("لطفاً یک مبلغ معتبر وارد کنید.");
        return;
    }
    const amountUSDT = (amountToman / usdtRate).toFixed(2);
    // باز کردن لینک NowPayments با مقدار دقیق USDT
    const apiKey = 'MP94SK3-2RNMDJ4-PPKQWSS-GHCVMNJ';
    const url = `https://nowpayments.io/donation?api_key=${apiKey}&amount=${amountUSDT}&currency=usdt`;
    window.open(url, '_blank');
});

// هر 30 ثانیه نرخ را آپدیت کن
fetchRate();
setInterval(fetchRate, 30000);
</script>
</body>
</html>
