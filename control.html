<!DOCTYPE html>
<html lang="fa">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dashboard کنترل Goal</title>
<style>
body { font-family:'Vazirmatn',sans-serif; padding:20px; background:#111; color:#0f0; }
input, button { font-size:1em; margin:5px; }
#goal-preview { margin-top:20px; }
</style>
</head>
<body>

<h2>کنترل Goal و دونیت‌ها</h2>
<label>نام هدف: <input type="text" id="goal-title-input"></label>
<label>مبلغ هدف (تومان): <input type="number" id="goal-amount-input"></label>
<label>مبلغ کنونی (تومان): <input type="number" id="current-amount-input"></label>
<button id="update-goal">به‌روزرسانی</button>

<div id="goal-preview"></div>

<script>
// عناصر
const titleInput = document.getElementById('goal-title-input');
const goalInput = document.getElementById('goal-amount-input');
const currentInput = document.getElementById('current-amount-input');
const updateBtn = document.getElementById('update-goal');
const previewDiv = document.getElementById('goal-preview');

let currentAmount = parseInt(localStorage.getItem('currentAmount')) || 0;
let goalAmount = parseInt(localStorage.getItem('goalAmount')) || 6000000;
let goalTitle = localStorage.getItem('goalTitle') || 'خرید وبکم';

// نمایش زنده
function renderPreview() {
  previewDiv.innerHTML = `
    <strong>هدف: ${goalTitle}</strong><br>
    تاکنون ${currentAmount.toLocaleString()} از ${goalAmount.toLocaleString()} تومان حمایت شده
  `;
}
renderPreview();

// ارتباط با goal.html و OBS
const bc = new BroadcastChannel('goal_channel');
function broadcast() {
  bc.postMessage({ currentAmount, goalAmount, goalTitle });
}

// به‌روزرسانی از فرم
updateBtn.onclick = () => {
  goalTitle = titleInput.value || goalTitle;
  goalAmount = parseInt(goalInput.value) || goalAmount;
  currentAmount = parseInt(currentInput.value) || currentAmount;

  localStorage.setItem('goalTitle', goalTitle);
  localStorage.setItem('goalAmount', goalAmount);
  localStorage.setItem('currentAmount', currentAmount);

  renderPreview();
  broadcast();
};
</script>

</body>
</html>
