<!DOCTYPE html>
<html lang="fa">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>کنترل حمایت‌ها – میلاد کاتاکوری</title>
<style>
    body { font-family: Tahoma, sans-serif; background: #f4f4f4; padding: 20px; }
    .control-box { max-width: 600px; margin: auto; background: #fff; padding: 25px; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); }
    h2 { text-align: center; margin-bottom: 20px; }
    table { width: 100%; border-collapse: collapse; }
    th, td { padding: 10px; border-bottom: 1px solid #ddd; text-align: center; }
    th { background: #f0f0f0; }
</style>
</head>
<body>

<div class="control-box">
    <h2>آخرین حمایت‌ها</h2>
    <table>
        <thead>
            <tr>
                <th>نام</th>
                <th>مبلغ (تومان)</th>
                <th>مبلغ (USDT)</th>
                <th>تاریخ</th>
            </tr>
        </thead>
        <tbody id="donationList">
            <!-- دونیت‌ها اینجا اضافه می‌شوند -->
        </tbody>
    </table>
</div>

<script>
let usdtRate = 0;

// دریافت نرخ لحظه‌ای تتر
async function fetchUSDT() {
    try {
        const res = await fetch('https://api.nobitex.ir/v2/orderbook/?market=usdt-irt');
        const data = await res.json();
        usdtRate = parseFloat(data.ticker.last);
        updateDonationTable();
    } catch(e) {
        console.error('خطا در دریافت نرخ تتر:', e);
    }
}

// داده‌های نمونه، بعداً می‌تونی از پایگاه داده واقعی استفاده کنی
let donations = [
    {name: 'میلاد', amountToman: 666000, date: '1404/07/20'},
    {name: 'کاربر ۲', amountToman: 350000, date: '1404/07/21'}
];

function updateDonationTable() {
    const tbody = document.getElementById('donationList');
    tbody.innerHTML = '';
    donations.forEach(d => {
        const amountUSDT = usdtRate ? (d.amountToman / usdtRate).toFixed(2) : 0;
        const tr = document.createElement('tr');
        tr.innerHTML = `
            <td>${d.name}</td>
            <td>${d.amountToman.toLocaleString()}</td>
            <td>${amountUSDT}</td>
            <td>${d.date}</td>
        `;
        tbody.appendChild(tr);
    });
}

setInterval(fetchUSDT, 30000);
fetchUSDT();
</script>

</body>
</html>
