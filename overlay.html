<!DOCTYPE html>
<html lang="fa">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Overlay Ø­Ù…Ø§ÛŒØª - ØµÙ Ù¾Ø±Ø¯Ø§Ø®Øª Ù‡Ø§ + Ø¢Ù…Ø§Ø± Ø²Ù†Ø¯Ù‡</title>
<style>
/* ____________________ ğŸ¬ Ø§Ø³ØªØ§ÛŒÙ„ Overlay ğŸ¬ ____________________ */
body {
  margin:0;
  font-family:'Vazirmatn',sans-serif;
  background:transparent;
  color:#00ff99;
  text-align:center;
  direction:rtl;
  overflow:hidden;
}

/* -------------------- Ù¾Ù†Ù„ Ø²Ù†Ø¯Ù‡ Ø¬Ù…Ø¹ Ú©Ù„ Ùˆ Ø¯Ø±ØµØ¯ Ù‡Ø¯Ù -------------------- */
#stats {
  position:fixed;
  bottom:10px;
  left:10px;
  font-size:1.2em;
  background:rgba(0,0,0,0.7);
  border-radius:12px;
  padding:15px 20px;
  color:#00ff99;
  text-shadow:0 0 12px #00ff99;
  z-index:5;
}

/* -------------------- Overlay Ù‡Ø´Ø¯Ø§Ø± Ù¾Ø±Ø¯Ø§Ø®Øª -------------------- */
#overlay {
  position:fixed;
  inset:0;
  pointer-events:none;
}
#donation-alert {
  position:absolute;
  top:50%;
  left:50%;
  transform:translate(-50%,-50%);
  text-align:center;
  background:rgba(0,0,0,0.7);
  border:2px solid #00ff99;
  border-radius:20px;
  padding:20px 30px;
  display:none;
  z-index:10;
}
#donation-video {
  width:180px;
  height:180px;
  border-radius:12px;
  margin-bottom:15px;
}
#donor-text {
  font-size:1.3em;
  text-shadow:0 0 12px #00ff99;
  opacity:0;
  transition: opacity 0.7s ease-in-out;
}

@media(max-width:500px){
  #donation-video{width:140px;height:140px;}
  #donor-text{font-size:1.1em;}
  #stats{font-size:1em;padding:10px 15px;}
}
</style>
</head>
<body>

<!-- ____________________ ğŸ¬ Overlay Ù‡Ø´Ø¯Ø§Ø± Ù¾Ø±Ø¯Ø§Ø®Øª ğŸ¬ ____________________ -->
<div id="overlay">
  <div id="donation-alert">
    <video id="donation-video" src="alert-donate.mp4" autoplay muted></video>
    <p id="donor-text"></p>
  </div>
</div>

<!-- ____________________ ğŸ“Š Ù¾Ù†Ù„ Ø¬Ù…Ø¹ Ú©Ù„ Ùˆ Ø¯Ø±ØµØ¯ Ù‡Ø¯Ù ğŸ“Š ____________________ -->
<div id="stats">
  <p>ğŸ’° Ø¬Ù…Ø¹ Ú©Ù„: <span id="total">0</span> Ø±ÛŒØ§Ù„</p>
  <p>ğŸ¯ Ø¯Ø±ØµØ¯ Ù‡Ø¯Ù: <span id="percent">0</span>%</p>
</div>

<script>
/* ____________________ ğŸ¬ Ø§Ù„Ù…Ø§Ù† Ù‡Ø§ÛŒ DOM ğŸ¬ ____________________ */
const alertBox = document.getElementById('donation-alert');
const donorText = document.getElementById('donor-text');
const videoEl = document.getElementById('donation-video');
const totalEl = document.getElementById('total');
const percentEl = document.getElementById('percent');

/* ____________________ ğŸŸ¢ ØµÙ Ù¾Ø±Ø¯Ø§Ø®Øª Ù‡Ø§ ğŸŸ¢ ____________________ */
let donationQueue = [];
let isShowing = false;

/* ____________________ ğŸ¯ ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ù‡Ø¯Ù Ùˆ Ø¬Ù…Ø¹ Ú©Ù„ ğŸ¯ ____________________ */
let total = 0;
const target = 60000000;

/* ____________________ ğŸŒ Ø§ØªØµØ§Ù„ Ø¨Ù‡ ÙˆØ¨Ù‡ÙˆÚ© Ø¯Ø±ÛŒØ§ÙØª Ù¾Ø±Ø¯Ø§Ø®Øª Ù‡Ø§ ğŸŒ ____________________ */
async function fetchDonations(){
  try{
    const res = await fetch('https://eoyf8grpms15wjd.m.pipedream.net',{cache:'no-store'});
    const data = await res.json();
    data.forEach(d => {
      if(!d.handled){
        d.handled = true;
        donationQueue.push(d); // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø¨Ù‡ ØµÙ
        total += (d.amount*d.currency_rate || d.amount || 0); // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø¨Ù‡ Ø¬Ù…Ø¹ Ú©Ù„
        updateStats();
        showNextDonation();
      }
    });
  } catch(e){console.warn(e);}
}
setInterval(fetchDonations, 5000);

/* ____________________ ğŸ”¢ Ø¢Ù¾Ø¯ÛŒØª Ø¬Ù…Ø¹ Ú©Ù„ Ùˆ Ø¯Ø±ØµØ¯ Ù‡Ø¯Ù ğŸ”¢ ____________________ */
function updateStats(){
  totalEl.textContent = total.toLocaleString('fa-IR');
  percentEl.textContent = Math.min(((total/target)*100).toFixed(1),100);
}

/* ____________________ ğŸ¬ Ù†Ù…Ø§ÛŒØ´ Ù¾Ø±Ø¯Ø§Ø®Øª Ù‡Ø§ Ø§Ø² ØµÙ ğŸ¬ ____________________ */
function showNextDonation(){
  if(isShowing || donationQueue.length === 0) return;
  const d = donationQueue.shift();
  isShowing = true;
  
  const amountIRR = d.amount*d.currency_rate || d.amount || 0;
  donorText.textContent = (d.name||'Ø­Ø§Ù…ÛŒ Ù†Ø§Ø´Ù†Ø§Ø³') + ' | ' + amountIRR.toLocaleString('fa-IR') + ' Ø±ÛŒØ§Ù„' + (d.message?(' | '+d.message):'');
  
  alertBox.style.display='block';
  videoEl.currentTime=0;
  videoEl.play();
  
  donorText.style.opacity = 0;
  setTimeout(()=>{donorText.style.opacity = 1;}, 50);
  
  setTimeout(()=>{
    donorText.style.opacity = 0;
    setTimeout(()=>{
      alertBox.style.display='none';
      isShowing = false;
      showNextDonation(); // Ù†Ù…Ø§ÛŒØ´ Ø¨Ø¹Ø¯ÛŒ Ø§Ø² ØµÙ
    }, 700);
  },13000);
}
</script>

</body>
</html>
