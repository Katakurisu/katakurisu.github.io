<!DOCTYPE html>
<html lang="fa">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Overlay حمایت</title>
<style>
/* ____________________ 🎬 استایل Overlay 🎬 ____________________ */
body {
  margin:0;
  font-family:'Vazirmatn',sans-serif;
  background:transparent;
  color:#00ff99;
  text-align:center;
  direction:rtl;
  overflow:hidden;
}
#overlay {
  position:fixed;
  inset:0;
  pointer-events:none;
}
#donation-alert {
  position:absolute;
  top:50%;
  left:50%;
  transform:translate(-50%,-50%);
  text-align:center;
  background:rgba(0,0,0,0.7);
  border:2px solid #00ff99;
  border-radius:20px;
  padding:20px 30px;
  display:none;
  z-index:10;
  animation:fadein 0.5s ease;
}
#donation-video {
  width:180px;
  height:180px;
  border-radius:12px;
  margin-bottom:15px;
}
#donor-text {
  font-size:1.3em;
  text-shadow:0 0 12px #00ff99;
}
@keyframes fadein {from{opacity:0;}to{opacity:1;}}
@media(max-width:500px){
  #donation-video{width:140px;height:140px;}
  #donor-text{font-size:1.1em;}
}
</style>
</head>
<body>

<!-- ____________________ 🎬 Overlay هشدار پرداخت 🎬 ____________________ -->
<div id="overlay">
  <div id="donation-alert">
    <video id="donation-video" src="alert-donate.mp4" autoplay muted></video>
    <p id="donor-text"></p>
  </div>
</div>

<script>
/* ____________________ 🎬 المان های DOM 🎬 ____________________ */
const alertBox = document.getElementById('donation-alert');
const donorText = document.getElementById('donor-text');
const videoEl = document.getElementById('donation-video');

/* ____________________ 🌐 اتصال به وبهوک دریافت پرداخت ها 🌐 ____________________ */
async function fetchDonations(){
  try{
    const res = await fetch('https://eoyf8grpms15wjd.m.pipedream.net',{cache:'no-store'});
    const data = await res.json();
    data.forEach(d => {
      if(!d.handled){
        d.handled = true;
        showDonation(d);
      }
    });
  } catch(e){console.warn(e);}
}
setInterval(fetchDonations, 5000);

/* ____________________ 🎬 نمایش پرداخت جدید 🎬 ____________________ */
function showDonation(d){
  const amountIRR = d.amount*d.currency_rate || d.amount || 0;
  donorText.textContent = (d.name||'حامی ناشناس') + ' | ' + amountIRR.toLocaleString('fa-IR') + ' ریال' + (d.message?(' | '+d.message):'');
  alertBox.style.display='block';
  videoEl.currentTime=0;
  videoEl.play();
  setTimeout(()=>{alertBox.style.display='none';},13000);
}
</script>

</body>
</html>
