<!DOCTYPE html>
<html lang="fa">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Overlay Ø­Ù…Ø§ÛŒØª</title>

<!-- ğŸ§© ÙÙˆÙ†Øª ÙØ§Ø±Ø³ÛŒ -->
<link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@400;600&display=swap" rel="stylesheet">

<style>
/* ==================== ğŸ¨ ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ú©Ù„ÛŒ ØµÙØ­Ù‡ ==================== */
body {
  margin:0;
  font-family:'Vazirmatn',sans-serif;
  background:transparent;
  color:#00ff99;
  text-align:center;
  direction:rtl;
  overflow:hidden;
}

/* ==================== ğŸ¥ Ø¨Ø§Ú©Ø³ Ø§ØµÙ„ÛŒ Ø§ÙˆØ±Ù„ÛŒ ==================== */
#overlay {
  position:fixed;
  inset:0;
  pointer-events:none;
  display:flex;
  justify-content:center;
  align-items:center;
  flex-direction:column;
}

/* ==================== ğŸ’š Ø¨Ø®Ø´ Ù†Ù…Ø§ÛŒØ´ Ø¯ÙˆÙ†ÛŒØª (ÙˆÛŒØ¯ÛŒÙˆ Ùˆ Ù…ØªÙ†) ==================== */
#donation-alert {
  position:relative;
  text-align:center;
  display:none;
  z-index:10;
}

/* ğŸ¬ ØªÙ†Ø¸ÛŒÙ…Ø§Øª ÙˆÛŒØ¯ÛŒÙˆÛŒ Ø¯ÙˆÙ†ÛŒØª */
#donation-video {
  width:300px;
  height:300px;
  border-radius:12px;
  margin-bottom:10px;
}

/* ==================== ğŸ’° Ù†Ù…Ø§ÛŒØ´ Ø¬Ù…Ø¹ Ú©Ù„ Ùˆ Ø¯Ø±ØµØ¯ Ù‡Ø¯Ù ==================== */
#stats {
  position:fixed;
  bottom:8%;
  left:50%;
  transform:translateX(-50%);
  font-size:1.3em;
  background:rgba(0,0,0,0.85);
  border-radius:14px;
  padding:20px 30px;
  color:#00ff99;
  text-shadow:0 0 12px #00ff99;
  line-height:1.8;
  z-index:5;
}

/* ==================== ğŸ§ª Ø¯Ú©Ù…Ù‡ ØªØ³Øª Ø¯ÙˆÙ†ÛŒØª ==================== */
#test-btn {
  position:fixed;
  top:60px;
  right:20px;
  z-index:20;
  padding:10px 20px;
  font-size:1em;
  background:#000;
  color:#00ff99;
  border:2px solid #00ff99;
  border-radius:8px;
  cursor:pointer;
}

/* ==================== â° Ø³Ø§Ø¹Øª Ø²Ù†Ø¯Ù‡ ==================== */
#clock {
  position:fixed;
  top:20px;
  right:20px;
  font-size:1.2em;
  color:#00ff99;
}

/* ==================== ğŸ“± Ù†Ø³Ø®Ù‡ Ù…ÙˆØ¨Ø§ÛŒÙ„ (Ú©ÙˆÚ†Ú©â€ŒØªØ±) ==================== */
@media(max-width:500px){
  #donation-video{width:200px;height:200px;}
  #stats{padding:15px 20px;font-size:1.1em;}
}
</style>
</head>

<body>

<!-- ==================== ğŸ§© Ù…Ø­ØªÙˆØ§ÛŒ Ø§ØµÙ„ÛŒ Ø§ÙˆØ±Ù„ÛŒ ==================== -->
<div id="overlay">

  <!-- ğŸ¥ Ù‡Ø´Ø¯Ø§Ø± Ø¯ÙˆÙ†ÛŒØª (ÙˆÛŒØ¯ÛŒÙˆ + ØªÙˆØ¶ÛŒØ­) -->
  <div id="donation-alert">
    <video id="donation-video" src="alert-donate.mp4" autoplay></video>
    <p id="donor-text"></p>
  </div>

  <!-- ğŸ’° Ø¢Ù…Ø§Ø± Ø­Ù…Ø§ÛŒØªâ€ŒÙ‡Ø§ -->
  <div id="stats">
    <p>ğŸ’° Ø¬Ù…Ø¹ Ú©Ù„: <span id="total">0</span> Ø±ÛŒØ§Ù„</p>
    <p>ğŸ¯ Ø¯Ø±ØµØ¯ Ù‡Ø¯Ù: <span id="percent">0</span>%</p>
  </div>

</div>

<!-- ==================== ğŸ•’ Ø³Ø§Ø¹Øª Ø²Ù†Ø¯Ù‡ Ùˆ Ø¯Ú©Ù…Ù‡ ØªØ³Øª ==================== -->
<div id="clock"></div>
<button id="test-btn" onclick="testDonation()">Test Donation</button>

<script>
/* ==================== â° Ø³Ø§Ø¹Øª Ø²Ù†Ø¯Ù‡ ==================== */
function updateClock(){
  const now=new Date();
  document.getElementById('clock').textContent =
    now.toLocaleTimeString('fa-IR',{hour:'2-digit',minute:'2-digit',second:'2-digit'});
}
setInterval(updateClock,1000);
updateClock();

/* ==================== ğŸ’š Ù…ØªØºÛŒØ±Ù‡Ø§ Ùˆ Ù‡Ø¯Ù Ù…Ø§Ù„ÛŒ ==================== */
const alertBox=document.getElementById('donation-alert');
const donorText=document.getElementById('donor-text');
const videoEl=document.getElementById('donation-video');
const totalEl=document.getElementById('total');
const percentEl=document.getElementById('percent');
let total=0, target=60000000;

/* ==================== ğŸ¥ Ù†Ù…Ø§ÛŒØ´ Ø§Ù†ÛŒÙ…ÛŒØ´Ù† Ø¯ÙˆÙ†ÛŒØª ==================== */
function showDonation(d){
  const amountIRR=d.amount*d.currency_rate||d.amount||0;

  // Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ù…Ø¬Ù…ÙˆØ¹
  total+=amountIRR;
  donorText.textContent=(d.name||'Ø­Ø§Ù…ÛŒ Ù†Ø§Ø´Ù†Ø§Ø³')+' | '+amountIRR.toLocaleString('fa-IR')+' Ø±ÛŒØ§Ù„'+(d.message?(' | '+d.message):'');
  totalEl.textContent=total.toLocaleString('fa-IR');
  percentEl.textContent=Math.min(((total/target)*100).toFixed(1),100);

  // Ù¾Ø®Ø´ ÙˆÛŒØ¯ÛŒÙˆ Ø¨Ø§ ØµØ¯Ø§
  alertBox.style.display='block';
  videoEl.currentTime=0;
  videoEl.muted=false;
  videoEl.play();

  // Ù…Ø®ÙÛŒâ€ŒØ³Ø§Ø²ÛŒ Ø¨Ø¹Ø¯ Ø§Ø² 13 Ø«Ø§Ù†ÛŒÙ‡
  setTimeout(()=>alertBox.style.display='none',13000);
}

/* ==================== ğŸ§ª Ø¯Ú©Ù…Ù‡ ØªØ³Øª (Ø¨Ø±Ø§ÛŒ Ù…Ø±ÙˆØ±Ú¯Ø±) ==================== */
function testDonation(){
  showDonation({
    name:'Ø­Ø§Ù…ÛŒ ØªØ³Øª',
    amount:50000,
    currency_rate:1,
    message:'Ø§ÛŒÙ† ÛŒÚ© ØªØ³Øª Ø§Ø³Øª'
  });
}

/* ==================== ğŸ–¥ï¸ ØªØ´Ø®ÛŒØµ Ø§Ø¬Ø±Ø§ Ø¯Ø± OBS ==================== */
function isInOBS(){
  try {
    return window.self !== window.top;
  } catch {
    return true;
  }
}

/* âŒ Ø§Ú¯Ø± Ø¯Ø§Ø®Ù„ OBS Ø¨ÙˆØ¯ â†’ Ø³Ø§Ø¹Øª Ùˆ Ø¯Ú©Ù…Ù‡ ØªØ³Øª Ø±Ø§ Ù…Ø®ÙÛŒ Ú©Ù† */
if (isInOBS()) {
  document.getElementById('test-btn').style.display='none';
  document.getElementById('clock').style.display='none';
}
</script>

</body>
</html>
