<!DOCTYPE html>
<html lang="fa">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Overlay Donates</title>
<style>
body {margin:0; background:transparent; font-family: Vazirmatn,sans-serif; overflow:hidden;}
#overlay {position:fixed; top:50%; left:50%; transform:translate(-50%,-50%); text-align:center; z-index:999;}
#donation-video {width:400px; max-width:90vw; border-radius:16px;}
#donor-info {margin-top:15px; color:#00ff99; text-shadow:0 0 10px #00ff99; font-size:1.3em; line-height:1.4;}
.hidden {display:none;}
</style>
</head>
<body>

<div id="overlay">
    <video id="donation-video" class="hidden" autoplay></video>
    <div id="donor-info" class="hidden"></div>
</div>

<script>
// لینک فایل ویدیویی داخل پوشه alert-donate.mp4
const video = document.getElementById('donation-video');
const info = document.getElementById('donor-info');

function showDonation(name, amount, message) {
    video.src = 'alert-donate.mp4';
    video.classList.remove('hidden');
    info.classList.remove('hidden');
    info.innerHTML = `$ حمایت جدید دریافت شد $<br>${name}<br>${amount.toLocaleString('fa-IR')} ریال`;
    if(message) info.innerHTML += `<br>${message}`;
    video.play().catch(()=>{});
    setTimeout(() => {
        video.classList.add('hidden');
        info.classList.add('hidden');
    }, 13000); // 13 ثانیه نمایش
}

// --- مثال تست ---
//showDonation("میلاد کاتاکوری", 50000, "خیلی خوشحالم از حمایتتون!");


// دریافت Webhook از Pipedream
async function pollWebhook() {
    try {
        const res = await fetch('https://eoyf8grpms15wjd.m.pipedream.net');
        const data = await res.json();
        // داده‌ها باید شامل: name, amount, message
        if(data && data.name && data.amount){
            showDonation(data.name, data.amount, data.message);
        }
    } catch(e){
        console.warn("خطا در دریافت وبهوک:", e);
    }
    setTimeout(pollWebhook, 5000); // هر 5 ثانیه چک کن
}

pollWebhook();
</script>

</body>
</html>
