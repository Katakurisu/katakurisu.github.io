<!DOCTYPE html>
<html lang="fa">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Overlay حمایت</title>

<!-- 🧩 فونت فارسی -->
<link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@400;600&display=swap" rel="stylesheet">

<style>
/* ==================== 🎨 تنظیمات کلی صفحه ==================== */
body {
  margin:0;
  font-family:'Vazirmatn',sans-serif;
  background:transparent;
  color:#00ff99;
  text-align:center;
  direction:rtl;
  overflow:hidden;
}

/* ==================== 🎥 باکس اصلی اورلی ==================== */
#overlay {
  position:fixed;
  inset:0;
  pointer-events:none;
  display:flex;
  justify-content:center;
  align-items:center;
  flex-direction:column;
}

/* ==================== 💚 بخش نمایش دونیت (ویدیو و متن) ==================== */
#donation-alert {
  position:relative;
  text-align:center;
  display:none;
  z-index:10;
}

/* 🎬 تنظیمات ویدیوی دونیت */
#donation-video {
  width:300px;
  height:300px;
  border-radius:12px;
  margin-bottom:10px;
}

/* ==================== 💰 نمایش جمع کل و درصد هدف ==================== */
#stats {
  position:fixed;
  bottom:8%;
  left:50%;
  transform:translateX(-50%);
  font-size:1.3em;
  background:rgba(0,0,0,0.85);
  border-radius:14px;
  padding:20px 30px;
  color:#00ff99;
  text-shadow:0 0 12px #00ff99;
  line-height:1.8;
  z-index:5;
}

/* ==================== 🧪 دکمه تست دونیت ==================== */
#test-btn {
  position:fixed;
  top:60px;
  right:20px;
  z-index:20;
  padding:10px 20px;
  font-size:1em;
  background:#000;
  color:#00ff99;
  border:2px solid #00ff99;
  border-radius:8px;
  cursor:pointer;
}

/* ==================== ⏰ ساعت زنده ==================== */
#clock {
  position:fixed;
  top:20px;
  right:20px;
  font-size:1.2em;
  color:#00ff99;
}

/* ==================== 📱 نسخه موبایل (کوچک‌تر) ==================== */
@media(max-width:500px){
  #donation-video{width:200px;height:200px;}
  #stats{padding:15px 20px;font-size:1.1em;}
}
</style>
</head>

<body>

<!-- ==================== 🧩 محتوای اصلی اورلی ==================== -->
<div id="overlay">

  <!-- 🎥 هشدار دونیت (ویدیو + توضیح) -->
  <div id="donation-alert">
    <video id="donation-video" src="alert-donate.mp4" autoplay></video>
    <p id="donor-text"></p>
  </div>

  <!-- 💰 آمار حمایت‌ها -->
  <div id="stats">
    <p>💰 جمع کل: <span id="total">0</span> ریال</p>
    <p>🎯 درصد هدف: <span id="percent">0</span>%</p>
  </div>

</div>

<!-- ==================== 🕒 ساعت زنده و دکمه تست ==================== -->
<div id="clock"></div>
<button id="test-btn" onclick="testDonation()">Test Donation</button>

<script>
/* ==================== ⏰ ساعت زنده ==================== */
function updateClock(){
  const now=new Date();
  document.getElementById('clock').textContent =
    now.toLocaleTimeString('fa-IR',{hour:'2-digit',minute:'2-digit',second:'2-digit'});
}
setInterval(updateClock,1000);
updateClock();

/* ==================== 💚 متغیرها و هدف مالی ==================== */
const alertBox=document.getElementById('donation-alert');
const donorText=document.getElementById('donor-text');
const videoEl=document.getElementById('donation-video');
const totalEl=document.getElementById('total');
const percentEl=document.getElementById('percent');
let total=0, target=60000000;

/* ==================== 🎥 نمایش انیمیشن دونیت ==================== */
function showDonation(d){
  const amountIRR=d.amount*d.currency_rate||d.amount||0;

  // بروزرسانی مجموع
  total+=amountIRR;
  donorText.textContent=(d.name||'حامی ناشناس')+' | '+amountIRR.toLocaleString('fa-IR')+' ریال'+(d.message?(' | '+d.message):'');
  totalEl.textContent=total.toLocaleString('fa-IR');
  percentEl.textContent=Math.min(((total/target)*100).toFixed(1),100);

  // پخش ویدیو با صدا
  alertBox.style.display='block';
  videoEl.currentTime=0;
  videoEl.muted=false;
  videoEl.play();

  // مخفی‌سازی بعد از 13 ثانیه
  setTimeout(()=>alertBox.style.display='none',13000);
}

/* ==================== 🧪 دکمه تست (برای مرورگر) ==================== */
function testDonation(){
  showDonation({
    name:'حامی تست',
    amount:50000,
    currency_rate:1,
    message:'این یک تست است'
  });
}

/* ==================== 🖥️ تشخیص اجرا در OBS ==================== */
function isInOBS(){
  try {
    return window.self !== window.top;
  } catch {
    return true;
  }
}

/* ❌ اگر داخل OBS بود → ساعت و دکمه تست را مخفی کن */
if (isInOBS()) {
  document.getElementById('test-btn').style.display='none';
  document.getElementById('clock').style.display='none';
}
</script>

</body>
</html>
