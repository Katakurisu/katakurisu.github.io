<!DOCTYPE html>
<html lang="fa">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Donation Overlay - Katakuri</title>
<style>
body{margin:0;font-family:Arial,sans-serif;background:transparent;color:#fff;text-align:center;}
h1{margin-top:20px;}
.btn{display:inline-block;margin:10px;padding:15px 30px;background:#ff5f5f;color:#fff;text-decoration:none;border-radius:10px;font-size:18px;}
.btn:hover{background:#ff2f2f;}
#overlay{position:fixed;top:0;left:0;width:100%;height:100%;pointer-events:none;}
#donation-alert{position:absolute;top:20%;left:50%;transform:translateX(-50%);text-align:center;background:rgba(0,0,0,0.6);padding:20px;border-radius:15px;animation:fadein 1s;display:none;}
#donation-gif{width:150px;height:150px;}
#stats{position:absolute;bottom:10%;left:50%;transform:translateX(-50%);text-align:center;font-size:24px;}
@keyframes fadein{from{opacity:0;}to{opacity:1;}}
</style>
</head>
<body>

<h1>حمایت کنید ❤️</h1>

<a class="btn" href="https://zarinp.al/katakuri" target="_blank">💳 پرداخت ریالی</a>
<a class="btn" href="https://nowpayments.io/donation/katakuri" target="_blank">₿ پرداخت کریپتو</a>

<div id="overlay">
  <div id="donation-alert">
    <img id="donation-gif" src="https://media.giphy.com/media/3o7TKPcehQvZqg2rZu/giphy.gif" alt="Donation">
    <p id="donor-name"></p>
    <p id="donor-amount"></p>
  </div>
  <div id="stats">
    <p>جمع کل: <span id="total">0</span> ریال</p>
    <p>درصد هدف: <span id="percent">0</span>%</p>
  </div>
</div>

<audio id="alert-sound" src="https://www.myinstants.com/media/sounds/alert.mp3"></audio>

<script>
const alertBox = document.getElementById('donation-alert');
const donorName = document.getElementById('donor-name');
const donorAmount = document.getElementById('donor-amount');
const totalEl = document.getElementById('total');
const percentEl = document.getElementById('percent');
const alertSound = document.getElementById('alert-sound');

let total = 0;
const target = 1000000;
let seenDonations = new Set();

// 🔹 لینک JSON عمومی دونیت‌ها (مثلاً npoint.io یا webhook.site)
const DONATIONS_URL = "https://api.npoint.io/xxxxxx"; // ← بعداً اینو می‌ذاری

function showDonation(d){
  let amountIRR = d.currency==="IRR" ? d.amount : d.amount*1400000000;
  total += amountIRR;
  donorName.innerText = d.name;
  donorAmount.innerText = amountIRR.toLocaleString() + " ریال";
  alertBox.style.display = "block";
  alertSound.play();
  totalEl.innerText = total.toLocaleString();
  percentEl.innerText = Math.min((total/target*100).toFixed(1),100);
  setTimeout(()=>alertBox.style.display="none",4000);
}

// 🔹 بررسی هر 5 ثانیه برای دونیت‌های جدید
async function fetchDonations(){
  try{
    const res = await fetch(DONATIONS_URL+"?t="+Date.now());
    const data = await res.json();
    data.forEach(d=>{
      if(!seenDonations.has(d.ts)){
        seenDonations.add(d.ts);
        showDonation(d);
      }
    });
  }catch(e){
    console.log("Error fetching donations",e);
  }
}

setInterval(fetchDonations,5000);
</script>

</body>
</html>
