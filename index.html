<!DOCTYPE html>
<html lang="fa">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>حمایت از میلاد کاتاکوری</title>
<style>
  body { font-family: Tahoma, sans-serif; background: #f8f8f8; display: flex; flex-direction: column; align-items: center; padding: 40px; }
  h1 { color: #333; }
  form { background: #fff; padding: 30px; border-radius: 10px; box-shadow: 0 0 10px rgba(0,0,0,0.1); width: 100%; max-width: 400px; }
  label { display: block; margin: 15px 0 5px; font-size: 16px; }
  input { width: 100%; padding: 12px; font-size: 16px; border: 1px solid #ccc; border-radius: 5px; }
  .converted { margin-top: 5px; font-size: 14px; color: #555; }
  button { margin-top: 20px; padding: 12px; font-size: 18px; width: 100%; border: none; border-radius: 5px; cursor: pointer; background: #fff; color: #000; border: 1px solid #ccc; }
  button:hover { background: #f0f0f0; }
</style>
</head>
<body>

<h1>حمایت از میلاد کاتاکوری</h1>
<form id="donationForm">
  <label for="name">نام</label>
  <input type="text" id="name" name="name" placeholder="نام خود را وارد کنید">

  <label for="phone">شماره تماس (اختیاری)</label>
  <input type="text" id="phone" name="phone" placeholder="مثال: 09121234567">

  <label for="amount">مبلغ به تومان</label>
  <input type="number" id="amount" name="amount" placeholder="مثال: 100000">
  <div class="converted" id="converted">0 تومان = 0 USDT</div>

  <!-- دکمه NowPayments (بدون فیلد اضافی) -->
  <a href="https://nowpayments.io/donation?api_key=0289ad3c-32ce-4361-96a2-d2951b0ee943" target="_blank" rel="noreferrer noopener">
     <img src="https://nowpayments.io/images/embeds/donation-button-white.svg" alt="Crypto donation button by NOWPayments">
  </a>

  <!-- دکمه شاپرک -->
  <button type="button" id="shaparakBtn">پرداخت با شاپرک</button>
</form>

<script>
let usdtRate = 0;

async function fetchUSDT() {
  try {
    const res = await fetch('https://api.nobitex.ir/v2/orderbook?pair=USDTIRT');
    const data = await res.json();
    if (data && data.ticker && data.ticker.last) {
      usdtRate = parseFloat(data.ticker.last);
    } else {
      console.error('ساختار پاسخ نوبیتکس تغییر کرده:', data);
      usdtRate = 0;
    }
    updateConverted();
  } catch (err) {
    console.error('خطا در دریافت نرخ USDT:', err);
    usdtRate = 0;
    updateConverted();
  }
}

function updateConverted() {
  const amount = parseFloat(document.getElementById('amount').value) || 0;
  const usdt = (usdtRate ? (amount / usdtRate).toFixed(6) : 0);
  document.getElementById('converted').innerText = `${amount.toLocaleString('fa-IR')} تومان = ${usdt} USDT`;
}

document.getElementById('amount').addEventListener('input', updateConverted);

document.getElementById('shaparakBtn').addEventListener('click', () => {
  const amount = parseFloat(document.getElementById('amount').value);
  const name = document.getElementById('name').value;
  const phone = document.getElementById('phone').value;
  
  if (!amount || amount <= 0) { alert('لطفاً مبلغ صحیح وارد کنید'); return; }

  // اینجا لینک پرداخت شاپرک بساز
  const link = `https://katakurisu.github.io/payment?amount=${amount}&name=${encodeURIComponent(name)}&phone=${encodeURIComponent(phone)}`;
  window.open(link, '_blank');
});

// نرخ USDT هر 30 ثانیه آپدیت می‌شود
fetchUSDT();
setInterval(fetchUSDT, 30000);
</script>

</body>
</html>
